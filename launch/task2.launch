<launch>
  <!--DEFINE ARGUMENTS-->
  <arg name = "haarcascade_base_path" default = "/home/pal/iri-lab/iri_ws/src/nen/servers/shirt_color_detection/cfg/haarcascade_frontalface_alt.xml"/>
  <arg name = "rosbag_path" default = "/media/root/F703-CF86/tbm2_00/"/>
  <arg name="action_topic" default="/tiago/echo_action_server/task2_recognise" />
  <arg name="visualize" default="true" />
  <arg name="kimble_path" default="/home/pal/iri-lab/labrobotica/algorithms/erl_person_classifier/person_faces/kimble/kimble.jpeg" />
  <arg name="postman_path" default="/home/pal/iri-lab/labrobotica/algorithms/erl_person_classifier/person_faces/postman/postman.jpg" />


  <include file="$(find audio_capture)/launch/capture.launch"/>

  <include file="$(find log_nodes)/launch/erl_log_tmb2.launch">
    <arg name="rosbag_path" value="$(arg rosbag_path)" />
  </include>

  <include file="$(find image_diff)/launch/image_diff.launch"/>

  <node pkg="task2_client"
 	type="task2_client"
  	name="task2_client"
  	output="screen"
    respawn="false"
  	ns="/tiago">
    <param name="~kimble_path" type="string" value="$(arg kimble_path)" />
    <param name="~postman_path" type="string" value="$(arg postman_path)" />


    <!-- device (bell) remapping -->
       <remap from="~/devices_module/bell" to="/roah_rsbb/devices/bell"/>

       <!-- Referee Module -->
          <remap from="~/task2_referee/end_execute"
                   to="/roah_rsbb/end_execute"/>
          <remap from="~/task2_referee/end_prepare"
                    to="/roah_rsbb/end_prepare"/>
          <remap from="~/task2_referee/benchmark_state"
                    to="/roah_rsbb/benchmark/state"/>
          <remap from="~/task2_referee/benchmark"
                   to="/roah_rsbb/benchmark"/>
          <param name="~/task2_referee/poi" value="home"/>

          <rosparam file="$(find task2_client)/config/state_controller.yaml" command="load" ns="task2_referee" />

       <!-- Nav SubModule for Referee Module -->
          <remap from="~/task2_referee/nav_module/move_base"
                   to="/move_base"/>
          <remap from="~/task2_referee/nav_module/move_poi"
                   to="/poi_navigation_server/go_to_poi"/>
          <remap from="~/task2_referee/nav_module/move_waypoint"
                   to="/pal_waypoint/navigate"/>
          <remap from="~/task2_referee/nav_module/odom"
                   to="/mobile_base_controller/odom"/>
          <remap from="~/task2_referee/nav_module/clear_costmaps"
                   to="/move_base/clear_costmaps"/>
          <remap from="~/task2_referee/nav_module/change_map"
                   to="/pal_map_manager/change_map"/>
          <remap from="~/task2_referee/nav_module/set_op_mode"
                   to="/pal_navigation_sm"/>
          <remap from="~/task2_referee/nav_module/move_base_reconf"
                   to="/move_base/PalLocalPlanner/set_parameters"/>

          <rosparam file="$(find task2_client)/config/referee_nav.yaml" command="load" ns="task2_referee/nav_module" />


  <!-- tts remappings -->
          <remap from="~/tts_module/tts" to="/tts"/>
          <rosparam file="$(find task2_client)/config/tts.yaml" command="load" ns="tts_module" />


  <!-- navigation remappings -->
      <remap from="~/nav_module/move_base"
               to="/move_base"/>
      <remap from="~/nav_module/move_poi"
               to="/poi_navigation_server/go_to_poi"/>
      <remap from="~/nav_module/move_waypoint"
               to="/pal_waypoint/navigate"/>
      <remap from="~/nav_module/odom"
               to="/mobile_base_controller/odom"/>
      <remap from="~/nav_module/clear_costmaps"
               to="/move_base/clear_costmaps"/>
      <remap from="~/nav_module/change_map"
               to="/pal_map_manager/change_map"/>
      <remap from="~/nav_module/set_op_mode"
               to="/pal_navigation_sm"/>
      <remap from="~/nav_module/move_base_reconf"
               to="/move_base/PalLocalPlanner/set_parameters"/>

      <rosparam file="$(find task2_client)/config/nav.yaml" command="load" ns="nav_module" />

      <!--LOGS-->
      <!-- Log Order -->
      <remap from="~/log_module/log_orders"
               to="/erl_log_base/erl_log_tmb2/log_orders"/>
      <!-- En/Dis Logs -->
      <remap from="~/log_module/en_dis_logs"
               to="/erl_log_base/erl_log_tmb2/en_dis_logs"/>
      <!-- Act Log -->
      <remap from="~/log_module/act_log"
               to="/erl_log_base/erl_log_tmb2/activate_log"/>
      <!-- Topics -->
      <!-- Visitor -->
      <remap from="~/log_module/visitor"
               to="/erl_log_base/erl_log_tmb2/visitor"/>
      <!-- Notification -->
      <remap from="~/log_module/notification"
               to="/erl_log_base/erl_log_tmb2/notification"/>
      <!-- Trajectory -->
      <remap from="~/log_module/path"
               to="/erl_log_base/erl_log_tmb2/path"/>
      <!-- Command -->
      <remap from="~/log_module/command"
               to="/erl_log_base/erl_log_tmb2/command"/>

      <!-- HEAD module -->
      <remap from="~/head_module/move_head"
               to="/head_controller/follow_joint_trajectory"/>
      <remap from="~/head_module/point_head"
               to="/head_controller/point_head_action"/>
      <rosparam file="$(find task2_client)/config/head.yaml" command="load" ns="head_module" />

      <!-- RECOGNITION module-->
      <remap from="~/recognition_module/face_recognition/get_person" to="/tiago/face_recognition_server/get_person" />
      <remap from="~/recognition_module/face_recognition/store_person" to="/tiago/face_recognition_server/store_person_path" />
      <remap from="~/recognition_module/tts_module/tts" to="/tts" />
      <remap from="~/recognition_module/echo_module/listen" to="$(arg action_topic)" />
      <remap from="~/recognition_module/shirt_color_detection_module/shirt_color" to="/tiago/shirt_color_detection/shirt_color" />
      <remap from="~/recognition_module/log_module/en_dis_logs"
                   to="/erl_log_base/erl_log_tmb2/en_dis_logs"/>

      <rosparam file="$(find task2_client)/config/task2_tts.yaml" command="load" ns="recognition_module/tts_module" />

      <!-- ACTIONS module-->
      <remap from="~/actions_module/tts_module/tts" to="/tts" />
      <remap from="~/actions_module/play_motion_module/play_motion" to="/play_motion" />
      <remap from="~/actions_module/echo_module/listen" to="$(arg action_topic)" />
      <remap from="~/actions_module/log_module/en_dis_logs"
                   to="/erl_log_base/erl_log_tmb2/en_dis_logs"/>

      <rosparam file="$(find task2_client)/config/task2_tts.yaml" command="load" ns="actions_module/tts_module" />
      <rosparam file="$(find task2_client)/config/task2_play_motion.yaml" command="load" ns="actions_module/play_motion_module" />

      <!--navigation remappings-->
           <remap from="~/actions_module/nav_module/move_base"
                    to="/move_base"/>
           <remap from="~/actions_module/nav_module/move_poi"
                    to="/poi_navigation_server/go_to_poi"/>
           <remap from="~/actions_module/nav_module/move_waypoint"
                    to="/pal_waypoint/navigate"/>
           <remap from="~/actions_module/nav_module/odom"
                    to="/mobile_base_controller/odom"/>
           <remap from="~/actions_module/nav_module/clear_costmaps"
                    to="/move_base/clear_costmaps"/>
           <remap from="~/actions_module/nav_module/change_map"
                    to="/pal_map_manager/change_map"/>
           <remap from="~/actions_module/nav_module/set_op_mode"
                    to="/pal_navigation_sm"/>
           <remap from="~/actions_module/nav_module/move_base_reconf"
                    to="/move_base/PalLocalPlanner/set_parameters"/>

            <rosparam file="$(find task2_client)/config/task2_nav.yaml" command="load" ns="actions_module/nav_module" />

      <!--Gripper module-->
          <remap from="~/actions_module/gripper_module/gripper_trajectory"
                 to="/gripper_controller/follow_joint_trajectory"/>
          <remap from="~/actions_module/gripper_module/grasp"
                 to="/gripper_controller/grasp"/>
          <rosparam file="$(find tiago_modules)/config/gripper_module_default.yaml" command="load" ns="gripper_module" />


      <remap from="~/actions_module/head_module/point_head" to="/head_controller/point_head_action" />
      <remap from="~/actions_module/head_module/move_head" to="/head_controller/follow_joint_trajectory" />

      <remap from="~/actions_module/image_diff_module/set_image" to="/tiago/image_diff/set_image" />
      <remap from="~/actions_module/image_diff_module/change" to="/tiago/image_diff/change" />


  </node>


  <include file="$(find person_face_recognition)/launch/person_face_recognition.launch"/>


  <include file="$(find shirt_color_detection)/launch/shirt_color_detection.launch">
          <arg name="visualize"  value="false" />
          <arg name="base_path" value="$(arg haarcascade_base_path)" />
  </include>

   <!-- launch dynamic reconfigure -->
   <node name="rqt_reconfigure" pkg="rqt_reconfigure" type="rqt_reconfigure" respawn="false" output="screen"/>

</launch>
